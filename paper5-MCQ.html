<!DOCTYPE html>
<html lang="en" class="scrollbar-gutter-stable">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#6366f1">
    
    <title>Prepogy Quiz Loader - CMA Practice</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Link to your External Question Database -->
    <script src="bm5.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Poppins', 'sans-serif'] },
                    colors: {
                        primary: { DEFAULT: '#6366f1', dark: '#4f46e5' },
                        success: '#10b981', error: '#ef4444', surface: '#ffffff',
                    },
                    boxShadow: {
                        soft: '0 10px 40px -10px rgba(0,0,0,0.06)',
                        hover: '0 20px 40px -5px rgba(99, 102, 241, 0.12)',
                    },
                    animation: {
                        'rise': 'rise 20s linear infinite',
                        'floating': 'floating 4s ease-in-out infinite',
                        'fade-in-up': 'fadeInUp 0.3s ease forwards',
                        'rotate-border': 'rotate-border 3s linear infinite',
                        'confetti-fall': 'confetti-fall 3s linear forwards',
                        'glow-purple': 'glow-purple 2.5s ease-in-out infinite',
                    },
                    keyframes: {
                        rise: { 'from': { transform: 'translateY(0) rotate(0deg)', opacity: '0.4' }, 'to': { transform: 'translateY(-120vh) rotate(360deg)', opacity: '0' } },
                        floating: { '0%, 100%': { transform: 'translateY(0px)' }, '50%': { transform: 'translateY(-12px)' } },
                        fadeInUp: { 'from': { opacity: '0', transform: 'translateY(10px)' }, 'to': { opacity: '1', transform: 'translateY(0)' } },
                        'rotate-border': { 'from': { transform: 'rotate(0deg)' }, 'to': { transform: 'rotate(360deg)' } },
                        'confetti-fall': { '0%': { transform: 'translateY(-100px) rotateZ(0deg)', opacity: '1' }, '100%': { transform: 'translateY(100vh) rotateZ(360deg)', opacity: '0' } },
                        'glow-purple': {
                            '0%, 100%': { color: '#B201E3', textShadow: '0 0 8px rgba(178, 1, 227, 0.4)' },
                            '50%': { color: '#5C01E3', textShadow: '0 0 12px rgba(92, 1, 227, 0.6)' }
                        }
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .text-gradient-original { @apply bg-clip-text text-transparent bg-[linear-gradient(135deg,#10b981,#6366f1,#db2777,#f59e0b)]; }
            .google-g-text {
                background: conic-gradient(#4285f4 0deg 90deg, #34a853 90deg 180deg, #fbbc05 180deg 270deg, #ea4335 270deg 360deg);
                -webkit-background-clip: text; -webkit-text-fill-color: transparent; @apply font-black;
            }
        }
        @layer components {
            .option {
                @apply flex items-center p-4 md:p-5 mb-3 bg-white border border-slate-200 rounded-2xl 
                       cursor-pointer transition-all duration-200 hover:scale-[1.015] hover:translate-x-1 hover:bg-violet-50 hover:shadow-hover hover:border-primary;
            }
            .option.disabled { @apply pointer-events-none; }
            .option.correct { @apply border-success bg-emerald-50; }
            .option.incorrect { @apply border-error bg-red-50; }
            .shape { @apply absolute bottom-[-150px] opacity-15 font-bold block will-change-transform animate-rise; line-height: 1; }
            .confetti-particle { @apply fixed top-0 left-0 w-2 h-2 rounded-full pointer-events-none z-[9999] animate-confetti-fall; }
            
            /* Soothing Home Button Styles */
            .btn-home {
                @apply bg-white border border-slate-200 px-5 py-2.5 rounded-full shadow-sm text-slate-500 font-bold text-xs 
                       transition-all duration-300 flex items-center gap-2 hover:bg-indigo-50 hover:text-primary 
                       hover:border-primary/30 hover:shadow-md active:scale-95;
            }

            .share-btn {
                @apply flex items-center justify-center gap-2 py-4 px-6 rounded-2xl font-bold text-sm text-white shadow-lg transition-all duration-300 hover:scale-[1.02] active:scale-95;
            }
        }
    </style>
</head>
<body class="font-sans bg-slate-50 text-gray-800 overflow-x-hidden antialiased min-h-screen flex flex-col">

    <!-- Background Shapes -->
    <div class="fixed inset-0 w-full h-full pointer-events-none -z-10 overflow-hidden select-none">
        <div class="shape left-[10%] text-[55px] text-emerald-500" style="animation-duration: 22s;">â‚¹</div>
        <div class="shape left-[50%] text-[55px] text-amber-500" style="animation-duration: 20s;">$</div>
        <div class="shape left-[80%] text-[65px] text-indigo-500" style="animation-duration: 28s;">Ã—</div>
        <div class="shape left-[30%] text-[45px] text-rose-500" style="animation-duration: 25s;">â‚¬</div>
    </div>

    <!-- Header -->
    <header class="text-center py-10 md:py-16 px-5 relative shrink-0">
        <div class="w-24 h-24 md:w-36 md:h-36 mx-auto mb-5 cursor-pointer transition-all duration-300 hover:scale-110 flex items-center justify-center animate-floating" onclick="location.href='index.html'">
            <img src="prep.png" alt="Prepogy Logo" class="w-full h-auto object-contain" onerror="this.src='https://via.placeholder.com/80?text=Logo'">
        </div>
        <h1 class="text-[clamp(2rem,6vw,3.5rem)] font-extrabold uppercase tracking-[2px] text-gradient-original mb-1">Prepogy</h1>
        <p class="text-[0.9em] text-slate-500 font-medium tracking-wide mt-1">Question Bank practice</p>
    </header>

    <main class="flex-grow flex flex-col max-w-2xl mx-auto px-5 w-full">
        <!-- Top Nav & Selector -->
        <div id="quizHeader" class="flex justify-between items-center mb-6">
            <button class="btn-home" onclick="location.href='index.html'">
                <i class="fas fa-home"></i> Home
            </button>
            <div class="flex items-center gap-3">
                <button onclick="location.reload()" class="text-[10px] text-red-400 font-bold uppercase tracking-wide">Reset</button>
                <select id="setSelector" class="max-w-[140px] md:max-w-[220px] bg-white rounded-xl px-4 py-2 text-xs font-bold border border-slate-200 shadow-sm outline-none focus:border-primary text-slate-600 cursor-pointer truncate">
                </select>
            </div>
        </div>

        <!-- Score Dashboard -->
        <div id="statsBar" class="bg-white rounded-3xl p-4 flex shadow-sm mb-8 border border-slate-100 divide-x divide-slate-100 animate-fade-in-up">
            <div class="flex-1 text-center">
                <span class="block text-xl md:text-2xl font-extrabold text-emerald-500 mb-1" id="scoreCorrect">0</span>
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Correct</span>
            </div>
            <div class="flex-1 text-center">
                <span class="block text-xl md:text-2xl font-extrabold text-red-500 mb-1" id="scoreWrong">0</span>
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Wrong</span>
            </div>
            <div class="flex-1 text-center">
                <span class="block text-xl md:text-2xl font-extrabold text-primary mb-1" id="scoreAcc">0%</span>
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Accuracy</span>
            </div>
        </div>

        <!-- Quiz Container -->
        <div id="questionArea" class="bg-white/95 backdrop-blur-md shadow-soft rounded-[28px] p-6 md:p-10 relative overflow-hidden transition-all duration-300 animate-fade-in-up">
            <i class="fas fa-pen-nib absolute -bottom-6 -right-6 text-[14rem] text-primary opacity-[0.03] -rotate-12 pointer-events-none"></i>
            
            <p id="qIndexDisplay" class="text-[10px] font-bold text-primary uppercase mb-4 relative z-10 tracking-widest"></p>
            <h2 id="qTextDisplay" class="text-lg md:text-xl font-bold text-gray-800 mb-8 leading-relaxed relative z-10">Loading questions...</h2>
            
            <div id="optionsContainer" class="space-y-3 relative z-10"></div>

            <div id="explanationContainer" class="relative z-10 mt-6 p-5 bg-slate-50 rounded-2xl border-l-4 border-primary hidden animate-fade-in-up">
                <div class="flex justify-between items-center mb-3">
                    <h4 class="text-xs font-bold uppercase text-primary tracking-wide">Explanation</h4>
                    <button onclick="openGoogleSearch()" class="relative p-[1.5px] rounded-full overflow-hidden inline-flex items-center justify-center cursor-pointer transition-transform hover:scale-105 group border-none bg-transparent">
                        <div class="absolute inset-0 bg-[conic-gradient(from_0deg,#4285f4,#34a853,#fbbc05,#ea4335,#4285f4)] animate-rotate-border"></div>
                        <div class="relative bg-white px-3 py-1.5 rounded-full flex items-center gap-1.5 z-10">
                            <i class="fas fa-magnifying-glass-chart text-primary text-xs"></i>
                            <span class="font-bold text-[10px] text-slate-600">ASK GURU <span class="google-g-text">G</span></span>
                        </div>
                    </button>
                </div>
                <p id="explanationText" class="text-sm text-slate-600 leading-relaxed"></p>
            </div>

            <!-- Swipe Guide -->
            <div class="md:hidden flex justify-center items-center gap-2 text-[8px] font-bold uppercase tracking-[0.2em] mt-8 pt-4 border-t border-slate-100 animate-glow-purple relative z-10">
                <i class="fas fa-left-right"></i>
                <span>Swipe to navigate</span>
            </div>

            <div class="flex justify-between mt-6 md:mt-10 pt-6 relative z-10">
                <button id="btnPrevQ" class="px-6 py-3 rounded-2xl font-bold transition-all flex items-center gap-2 bg-white border border-slate-200 text-slate-500 hover:bg-slate-50 disabled:opacity-0" onclick="changeQuestion(-1)">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button id="btnNextQ" class="px-6 py-3 rounded-2xl font-bold transition-all flex items-center gap-2 bg-primary text-white shadow-lg shadow-indigo-200" onclick="changeQuestion(1)">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Completion Page (Refined) -->
        <div id="resultsArea" class="hidden bg-white rounded-[32px] p-8 md:p-12 text-center shadow-2xl animate-fade-in-up border border-slate-100 relative overflow-hidden">
            <!-- Background Decorative Element -->
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-indigo-50 rounded-full opacity-50"></div>
            
            <div class="relative z-10">
                <div class="w-24 h-24 bg-gradient-to-tr from-indigo-500 to-primary text-white rounded-[2rem] flex items-center justify-center text-4xl mx-auto mb-6 shadow-xl animate-floating">
                    <i class="fas fa-trophy"></i>
                </div>
                
                <h2 class="text-3xl font-black text-slate-800 mb-2">Quiz Completed!</h2>
                <div id="finalScoreDisplay" class="inline-block bg-indigo-50 text-primary px-6 py-2 rounded-full font-extrabold text-sm mb-8 tracking-wide"></div>
                
                <!-- Community Support Section -->
                <div class="mb-8 p-6 bg-slate-50 rounded-[28px] border border-slate-100">
                    <div class="flex items-center justify-center gap-2 mb-3">
                        <i class="fas fa-heart text-rose-500 animate-pulse text-sm"></i>
                        <h4 class="text-xs font-bold uppercase tracking-widest text-slate-500">Support our Community</h4>
                    </div>
                    <p class="text-sm font-medium text-slate-600 leading-relaxed mb-6">
                        "Your contribution helps us keep this platform free and updated for every CMA aspirant. If you found this helpful, kindly share it with your study groups."
                    </p>
                    
                    <!-- Performance Quote Bubble -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-primary text-left relative">
                        <i class="fas fa-quote-left absolute top-4 left-4 text-primary opacity-10 text-xl"></i>
                        <p id="quoteDisplay" class="text-sm font-bold text-indigo-900 leading-relaxed italic relative z-10"></p>
                    </div>
                </div>

                <!-- Redesigned Share Grid -->
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <button onclick="shareToWhatsApp()" class="share-btn bg-gradient-to-r from-emerald-500 to-green-600 shadow-emerald-100">
                        <i class="fab fa-whatsapp text-lg"></i> WhatsApp
                    </button>
                    <button onclick="shareToTelegram()" class="share-btn bg-gradient-to-r from-sky-500 to-blue-600 shadow-blue-100">
                        <i class="fab fa-telegram-plane text-lg"></i> Telegram
                    </button>
                    <button onclick="copyResultLink()" class="col-span-2 share-btn bg-slate-800 shadow-slate-200">
                        <i class="fas fa-link"></i> Copy Referral Link
                    </button>
                </div>

                <!-- Footer Actions -->
                <div class="grid grid-cols-2 gap-4 pt-6 border-t border-slate-100">
                    <button onclick="location.reload()" class="py-4 rounded-2xl font-bold text-sm bg-primary text-white shadow-lg shadow-indigo-100 hover:bg-primary-dark transition-all">
                        Try Again
                    </button>
                    <button onclick="location.href='index.html'" class="py-4 rounded-2xl font-bold text-sm bg-slate-100 text-slate-500 hover:bg-slate-200 transition-all">
                        Main Menu
                    </button>
                </div>
                
                <div id="copyFeedback" class="absolute bottom-24 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-4 py-2 rounded-full text-[10px] font-bold uppercase tracking-widest hidden animate-fade-in-up">
                    Copied to Clipboard!
                </div>
            </div>
        </div>
    </main>

    <footer class="py-10 text-center shrink-0 border-t border-slate-100 mt-20">
        <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Prepogy Â© 2025</p>
    </footer>

    <script>
        let currentSetIdx = 0;
        let currentQIdx = 0;
        let score = { c: 0, w: 0 };
        let userAnswers = [];
        let questionsAttempted = [];
        let touchStartX = 0; // State for swipe gestures

        const qIndexEl = document.getElementById('qIndexDisplay');
        const qTextEl = document.getElementById('qTextDisplay');
        const optionsEl = document.getElementById('optionsContainer');
        const nextBtn = document.getElementById('btnNextQ');
        const prevBtn = document.getElementById('btnPrevQ');
        const setSelector = document.getElementById('setSelector');
        const explanationBox = document.getElementById('explanationContainer');
        const explanationText = document.getElementById('explanationText');

        const performanceQuotes = [
            "âš ï¸ Help us stay online! Share this link with just one friend today to keep our servers running.",
            "ðŸš€ Small acts lead to big impacts. Sharing this quiz takes 5 seconds but fuels months of practice for CMAs.",
            "ðŸ™ A Personal Request: We're a tiny team. Your share is our only marketing. Please spread the word!",
            "ðŸ“¢ Spread the Word! We can't survive without users like you. Recommend us to a peer today.",
            "ðŸ†˜ We Need You! Our future is in your hands. Please share this platform to keep it free for everyone.",
            "ðŸ¤ Let's make a deal: We provide the tools, you provide the share. Help us grow!",
            "ðŸ° Strong communities share resources. Post this link and strengthen our network."
        ];

        function initQuiz() {
            if (typeof quizSets === 'undefined') {
                qTextEl.textContent = "Error: Database not found.";
                return;
            }
            setSelector.innerHTML = quizSets.map((set, i) => `<option value="${i}">${set.setName}</option>`).join('');
            setSelector.onchange = (e) => loadSet(parseInt(e.target.value));
            loadSet(0);
            initGestures();
        }

        // Exact Swipe Gesture Implementation from original version
        function initGestures() {
            const area = document.getElementById('questionArea');
            area.addEventListener('touchstart', (e) => { 
                touchStartX = e.changedTouches[0].clientX; 
            }, { passive: true });
            
            area.addEventListener('touchend', (e) => {
                const diffX = touchStartX - e.changedTouches[0].clientX;
                // Threshold of 50px sensitivity
                if (Math.abs(diffX) > 50) { 
                    if (diffX > 0) changeQuestion(1); 
                    else changeQuestion(-1); 
                }
            }, { passive: true });
        }

        function loadSet(idx) {
            currentSetIdx = idx;
            currentQIdx = 0;
            score = { c: 0, w: 0 };
            const questions = quizSets[currentSetIdx].questions;
            userAnswers = new Array(questions.length).fill(null);
            questionsAttempted = new Array(questions.length).fill(false);
            document.getElementById('resultsArea').classList.add('hidden');
            document.getElementById('questionArea').classList.remove('hidden');
            document.getElementById('statsBar').classList.remove('hidden');
            document.getElementById('quizHeader').classList.remove('hidden');
            updateStats();
            renderQuestion();
        }

        function renderQuestion() {
            const set = quizSets[currentSetIdx].questions;
            const q = set[currentQIdx];
            qIndexEl.textContent = `Question ${currentQIdx + 1} / ${set.length}`;
            qTextEl.textContent = q.q;
            optionsEl.innerHTML = '';
            q.o.forEach((opt, i) => {
                const div = document.createElement('div');
                div.className = 'option';
                if (questionsAttempted[currentQIdx]) {
                    div.classList.add('disabled');
                    if (opt === q.c) div.classList.add('correct');
                    if (userAnswers[currentQIdx] === opt && opt !== q.c) div.classList.add('incorrect');
                } else {
                    div.onclick = () => handleAnswer(opt);
                }
                div.innerHTML = `<span class="w-9 h-9 rounded-lg bg-slate-100 flex items-center justify-center font-bold mr-4 shrink-0 text-slate-600 transition-colors">${String.fromCharCode(65 + i)}</span><span class="text-sm font-medium text-slate-700">${opt}</span>`;
                optionsEl.appendChild(div);
            });
            if (questionsAttempted[currentQIdx]) {
                explanationBox.classList.remove('hidden');
                explanationText.textContent = "Refer to Official CMA Study Material.";
            } else {
                explanationBox.classList.add('hidden');
            }
            prevBtn.style.visibility = (currentQIdx === 0) ? 'hidden' : 'visible';
            nextBtn.innerHTML = (currentQIdx === set.length - 1) ? 'Finish' : 'Next <i class="fas fa-arrow-right"></i>';
        }

        function handleAnswer(selected) {
            if (questionsAttempted[currentQIdx]) return;
            const correct = quizSets[currentSetIdx].questions[currentQIdx].c;
            questionsAttempted[currentQIdx] = true;
            userAnswers[currentQIdx] = selected;
            if (selected === correct) score.c++; else score.w++;
            updateStats();
            renderQuestion();
        }

        function updateStats() {
            const total = score.c + score.w;
            const acc = total > 0 ? Math.round((score.c / total) * 100) + '%' : '0%';
            document.getElementById('scoreCorrect').textContent = score.c;
            document.getElementById('scoreWrong').textContent = score.w;
            document.getElementById('scoreAcc').textContent = acc;
        }

        function changeQuestion(dir) {
            const set = quizSets[currentSetIdx].questions;
            const next = currentQIdx + dir;
            if (next >= 0 && next < set.length) {
                const area = document.getElementById('questionArea');
                area.classList.add('opacity-0', 'scale-95');
                setTimeout(() => { 
                    currentQIdx = next; 
                    renderQuestion(); 
                    area.classList.remove('opacity-0', 'scale-95'); 
                }, 150);
            } else if (next >= set.length) {
                showResults();
            }
        }

        function createConfetti() {
            const colors = ['#6366f1', '#10b981', '#f59e0b', '#db2777', '#0ea5e9'];
            for (let i = 0; i < 80; i++) {
                const p = document.createElement('div');
                p.className = 'confetti-particle';
                p.style.left = Math.random() * 100 + 'vw';
                p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                p.style.animationDelay = Math.random() * 2 + 's';
                p.style.width = Math.random() * 10 + 5 + 'px';
                p.style.height = p.style.width;
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 3000);
            }
        }

        function showResults() {
            document.getElementById('questionArea').classList.add('hidden');
            document.getElementById('statsBar').classList.add('hidden');
            document.getElementById('quizHeader').classList.add('hidden');
            const res = document.getElementById('resultsArea');
            res.classList.remove('hidden');
            
            const total = quizSets[currentSetIdx].questions.length;
            document.getElementById('finalScoreDisplay').textContent = `Correct: ${score.c} out of ${total}`;
            
            const quote = performanceQuotes[Math.floor(Math.random() * performanceQuotes.length)];
            document.getElementById('quoteDisplay').textContent = quote;

            createConfetti();
        }

        function shareToWhatsApp() {
            const total = quizSets[currentSetIdx].questions.length;
            const text = encodeURIComponent(`I scored ${score.c}/${total} on Prepogy CMA Quiz! ðŸš€ Try it yourself: ${window.location.href}`);
            window.open(`https://wa.me/?text=${text}`, '_blank');
        }

        function shareToTelegram() {
            const total = quizSets[currentSetIdx].questions.length;
            const text = encodeURIComponent(`I scored ${score.c}/${total} on Prepogy CMA Quiz! ðŸš€`);
            const url = encodeURIComponent(window.location.href);
            window.open(`https://t.me/share/url?url=${url}&text=${text}`, '_blank');
        }

        function copyResultLink() {
            const total = quizSets[currentSetIdx].questions.length;
            const textToCopy = `I scored ${score.c}/${total} on Prepogy CMA Quiz! Practice here: ${window.location.href}`;
            const temp = document.createElement("input");
            temp.value = textToCopy;
            document.body.appendChild(temp);
            temp.select();
            document.execCommand("copy");
            document.body.removeChild(temp);
            const fb = document.getElementById('copyFeedback');
            fb.classList.remove('hidden');
            setTimeout(() => fb.classList.add('hidden'), 3000);
        }

        function openGoogleSearch() {
            const q = quizSets[currentSetIdx].questions[currentQIdx];
            const query = `Explain why "${q.c}" is correct for: ${q.q}`;
            window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
        }

        document.addEventListener('keydown', (e) => {
            if (document.getElementById('resultsArea').classList.contains('hidden')) {
                const key = e.key.toLowerCase();
                const map = { 'a': 0, 'b': 1, 'c': 2, 'd': 3, '1': 0, '2': 1, '3': 2, '4': 3 };
                if (key in map) {
                    const opts = optionsEl.children;
                    if (opts[map[key]]) opts[map[key]].click();
                } else if (key === 'enter' || key === 'arrowright') {
                    changeQuestion(1);
                } else if (key === 'arrowleft') {
                    changeQuestion(-1);
                }
            }
        });

        window.onload = initQuiz;
    </script>
</body>
</html>